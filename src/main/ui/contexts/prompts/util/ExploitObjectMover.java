package ui.contexts.prompts.util;

import model.GadgetCollection;
import model.gadgets.ExploitObject;
import ui.contexts.ConsoleContext;
import ui.contexts.menus.CollectionEditor;
import ui.contexts.prompts.PromptContext;

// Represents a UI context that moves an ExploitObject to a different index in the same collection
public class ExploitObjectMover extends PromptContext {
    private ExploitObject exploitObject;

    public ExploitObjectMover(ConsoleContext parentContext) {
        super(
                parentContext,
                "Origin index",
                String.valueOf(((CollectionEditor) parentContext).getCollection().getLength() - 1)
        );
    }

    public ExploitObjectMover(ConsoleContext parentContext, ExploitObject exploitObject) {
        super(
                parentContext,
                "Destination index",
                String.valueOf(((CollectionEditor) parentContext).getCollection().getLength())
        );

        this.exploitObject = exploitObject;
    }

    public ConsoleContext handleInputInternal(String input) {
        int index = Integer.parseInt(input);
        GadgetCollection collection = ((CollectionEditor) getParentContext()).getCollection();

        if (exploitObject == null) {
            return readOrigin(collection, index);
        } else {
            return readDestination(collection, index);
        }
    }

    private ConsoleContext readOrigin(GadgetCollection collection, int index) {
        if (index >= 0 && collection.remove(index)) {
            exploitObject = collection.get(index);
            return new ExploitObjectMover(getParentContext(), exploitObject);
        } else {
            return getParentContext();
        }
    }

    private ConsoleContext readDestination(GadgetCollection collection, int index) {
        if (index < 0 || !collection.add(exploitObject, index)) {
            collection.add(exploitObject, collection.getLength());
        }

        return getParentContext();
    }
}
