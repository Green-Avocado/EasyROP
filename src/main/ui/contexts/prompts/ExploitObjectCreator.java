package ui.contexts.prompts;

import model.ExploitObject;
import ui.contexts.ConsoleContext;

import java.util.ArrayList;
import java.util.List;

// Represents a UI context that creates an ExploitObject from a list of prompt responses
// and adds it to a GadgetCollection
public class ExploitObjectCreator extends PromptContext {
    private final ExploitObject exploitObject;
    private final ArrayList<List<String>> promptData;
    private final ArrayList<String> responseData;

    // EFFECTS: Creates a new ExploitObjectCreator with the given parentContext, exploitObject, and promptData.
    //          Sets responseData to a new ArrayList. The prompt string and default response is set as
    //          the first pair in promptData.
    public ExploitObjectCreator(
            ConsoleContext parentContext,
            ExploitObject exploitObject,
            ArrayList<List<String>> promptData
    ) {
        super(parentContext, promptData.get(0).get(0), promptData.get(0).get(1));

        this.promptData = promptData;
        this.exploitObject = exploitObject;
        this.responseData = new ArrayList<>();
    }

    // MODIFIES: this, exploitObject
    // EFFECTS: Adds the input to responseData and removes the first pair from promptData.
    //          If there are still elements in promptData, returns this with the same fields.
    //          Otherwise, sets the fields of exploitObject using responseData and returns a new
    //          AddExploitObjectToIndex context with the same parentContext and the exploitObject.
    @Override
    public ConsoleContext handleInputInternal(String input) {
        responseData.add(input);
        promptData.remove(0);

        if (promptData.size() > 0) {
            setPrompt(promptData.get(0).get(0));
            setDefaultResponse(promptData.get(0).get(1));
            return this;
        } else {
            exploitObject.fromList(responseData);
            return new AddExploitObjectToIndex(getParentContext(), exploitObject);
        }
    }
}
